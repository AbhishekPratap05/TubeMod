const SHORTS = "//a[@title='Shorts']/..";
const TABS = "//ytd-feed-filter-chip-bar-renderer/..";

function hideElement(selector, hide) {
  let elements = document.evaluate(
    selector,
    document,
    null,
    XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
    null
  );

  for (let i = 0, length = elements.snapshotLength; i < length; i++) {
    elements.snapshotItem(i).style.display = hide ? "none" : "block";
  }
}

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "hideShorts") {
    hideElement(SHORTS, true);
    sendResponse({ result: "Shorts hidden." });
  }

  if (request.action === "showShorts") {
    hideElement(SHORTS, false);
    sendResponse({ result: "Shorts shown." });
  }

  if (request.action === "hideTabs") {
    hideElement(TABS, true);
    sendResponse({ result: "Tabs hidden." });
  }

  if (request.action === "showTabs") {
    hideElement(TABS, false);
    sendResponse({ result: "Tabs shown." });
  }
});

chrome.storage.sync.get(["shortsHidden"], function (result) {
  if (result.shortsHidden !== undefined) {
    console.log("Hide Shorts? " + result.shortsHidden);
    hideElement(SHORTS, result.shortsHidden);
  }
});

chrome.storage.sync.get(["tabsHidden"], function (result) {
  if (result.tabsHidden !== undefined) {
    console.log("Hide Tabs? " + result.tabsHidden);
    hideElement(TABS, result.tabsHidden);
  }
});
